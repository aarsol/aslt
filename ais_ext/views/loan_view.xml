<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<data>       
         
		<!-- Loans Reference in the Employee Profile -->
		<record id="view_employee_form_loan" model="ir.ui.view">
			<field name="name">hr.employee.form.loan</field>
			<field name="model">hr.employee</field>
			<field name="inherit_id" ref="hr.view_employee_form"/>
			<field name="arch" type="xml">
				<data>
					<xpath expr="//notebook" position="inside">
						<page string="Loan Information">
							<group>
							    <group colspan="4" col="4">
									<field name="loan_ids" nolabel="1" readonly="1"/>
							    </group>
							</group>
						</page>
					</xpath>
				</data>
			</field>
		</record>
		
		
		<!-- Loan Rule Tree -->
		<record id="hr_loans_tree_view" model="ir.ui.view">
			<field name="name">hr.loans.tree</field>
			<field name="model">hr.loans</field>
			<field name="arch" type="xml">
				<tree string="Loan Rules">
				    <field name="name"/>
				    <field name="code"/>
				    <field name="company_id" groups="base.group_multi_company" widget="selection"/>
				    <field name="amount_max"/>
				    <field name="amount_percentage"/>
				</tree>
			</field>
		</record>
		
		<!-- Loan Rule Form -->
		<record id="hr_loans_form_view" model="ir.ui.view">
			<field name="name">hr.loans.form</field>
			<field name="model">hr.loans</field>
			<field name="arch" type="xml">
				<form string="Loan Rules">
					<sheet>
						<label for="name" class="oe_edit_only"/>
						<h1><field name="name"/></h1>
						<group col="4">
						   <field name="code"/>
						   <field name="active"/>              
						   <field name="company_id" widget="selection" groups="base.group_multi_company"/>
						</group>
						<separator colspan="4" string="Accounting"/>
						<group col="4">
						   <field name="amount_max"/>
						   <field name="journal_id" options="{'no_quick_create':True, 'no_create_edit': True, 'limit': 10}"/>
						   <field name="shares_max"/>   
						   <field name="salary_rule_id"  domain="[('category_id.code', '=', 'DED')]" options="{'no_quick_create':True, 'no_create_edit': True, 'limit': 10}"/>
						   <field name="amount_percentage" />  
						</group>
						<group string="Description">
						    <field name="note"/>
						</group>
					</sheet>    
					</form>
				</field>
			</record>
		
			<!-- Loan Rule Action -->
			<record id="hr_loans_action_view" model="ir.actions.act_window">
				<field name="name">Loan Rules</field>
				<field name="res_model">hr.loans</field>
				<field name="view_mode">tree,form</field>
			</record>

			<!-- hr_loan Tree  -->
			<record id="hr_loan_tree_view" model="ir.ui.view">
				<field name="name">hr.loan.tree</field>
				<field name="model">hr.loan</field>
				<field name="arch" type="xml">
					<tree string="Loan" decoration-info="state == 'draft'" decoration-primary="state == 'validate'" decoration-success="state == 'paid'">
						<field name="name"/>
						<field name="code"/>
						<field name="employee_id" options="{'no_quick_create':True, 'no_create_edit': True, 'limit': 10}"/>
						<field name="loan_id" options="{'no_quick_create':True, 'no_create_edit': True, 'limit': 10}"/>
						<field name="remaining_debt"/>
						<field name="amount"/>
						<field name="city_id"/>
						<field name="branch_id"/>
						<field name="state"/>
					</tree>
				</field>
			</record>
		
			<!-- hr_loan Form -->
			<record id="hr_loan_from_view" model="ir.ui.view">
				<field name="name">hr.loan.form</field>
				<field name="model">hr.loan</field>
				<field name="arch" type="xml">
					<form string="Loan">
						<header>
							<button name="loan_confirm" type="object" string="Confirm" states="draft" groups="base.group_user" class="oe_highlight"/>
							<button name="loan_pay" type="object" string="Pay Loan" states="validate" groups="base.group_user" class="oe_highlight"/>
							<field name="state" widget="statusbar" nolabel="1"/>
						</header>
						<sheet>
							<div class="oe_title">
								<label for="name" class="oe_edit_only"/>
								<h1><field name="name"/></h1>
							</div>
							<group col="4">
								<field name="employee_id" options="{'no_quick_create':True, 'no_create_edit': True, 'limit': 10}"/>
								<field name="loan_id" options="{'no_quick_create':True, 'no_create_edit': True, 'limit': 10}"/>
								<field name="employee_code"/>
								<field name="city_id"/>
								<field name="branch_id"/>
							</group>
							<separator string='Information Loan Amount' colspan='4'/>
							<group>
								<group>
									<field name="amount"/>
									<field name="num_quotas"/>
									<field name="amount_quota"/>
								</group>
								<group>
									<field name="paid_quotas"/>
									<field name="paid_amount"/>
									<field name="remaining_debt"/>
								</group>
								<group string='Date of Payment of the Loan'>
									<field name="date_payment" />
									<field name="date_start" required="1"/>
									<field name="date_order" readonly="1"/>
								</group>
								<group string='Accounting Entry'>
									<field name="journal_id"  options="{'no_quick_create':True, 'no_create_edit': True, 'limit': 10}"/>
									<field name="payment_channel" widget="radio"/>
									<field name="debit_account_id" options="{'limit': 10, 'no_create': 1, 'no_create_edit': 1}" attrs="{'readonly': [('state' , '!=', 'draft')]}" />
									<field name="credit_account_id" options="{'limit': 10, 'no_create': 1, 'no_create_edit': 1}" attrs="{'readonly': [('state' , '!=', 'draft')]}" />
									<field name="move_id"  options="{'no_quick_create':True, 'no_create_edit': True, 'limit': 10}"/>
								</group>
							</group>
							<group string="Note" >
								<field name="note" nolabel="1" colspan="4"/>
							</group>

							<notebook>
								<page string="Installments">
									<field name="loan_line_ids">
										<tree string="Loan Line" editable="bottom">
											<field name="paid_date"/>
											<field name="paid_amount"/>
											<field name="paid" readonly="1"/>
											<field name="notes"/>
										</tree>
									</field>

									<group class="oe_subtotal_footer oe_right">
										<field name="total_amount" widget="monetary" options="{'currency_field': 'currency_id'}"/>
										<div>
											<label for="paid_amount"/>
											<button name="button_reset_balance_total" states="draft"
												string="(update)" class="oe_link oe_edit_only"
												type="object" help="Recompute Balance"/>
										</div>
										<field name="paid_amount" nolabel="1" widget="monetary" options="{'currency_field': 'currency_id'}"/>
										<field name="balance_amount" class="oe_subtotal_footer_separator" widget="monetary" options="{'currency_field': 'currency_id'}"/>
									</group>
									<!--
									<button type="object" name="compute_loan_line" string="Compute" icon="terp-stock_format-scientific" colspan="2" attrs="{'invisible':[('state','=','approve')]}"/>
									-->
								</page>
							</notebook>
						</sheet>
						<div class="oe_chatter">
							<field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
							<field name="activity_ids" widget="mail_activity"/>
							<field name="message_ids" widget="mail_thread"/>
						</div>
				</form>
			</field>
		</record>
       
		<!-- hr_loan Search -->
		<record id="hr_loan_filter_view" model="ir.ui.view">
			<field name="name">hr.loan.select</field>
			<field name="model">hr.loan</field>    
			<field name="arch" type="xml">
				<search string="Search loans">
					<field name="employee_id"/>
					<field name="employee_code"/>
					<field name="city_id"/>
					<field name="branch_id"/>
					<field name="loan_id"/>
					<field name="date_start"/>
					<field name="date_order"/>

					<filter string="Draft" name="filter_draft" domain="[('state','=','draft')]" />
					<filter string="Confirmed" name="filter_validated" domain="[('state','=','validate')]" />
					<filter string="Paid" name="filter_paid" domain="[('state','=','paid')]" />
					<filter string="Payment Date" name="filter_payment_date" date="date_payment"/>
					<filter string="Start Date" name="filter_start_date" date="date_start"/>

					<group expand="0" string="Group By...">
						<filter string="Employee" name="employee_id" domain="[]" context="{'group_by':'employee_id'}"/>
						<filter string="Payment Date" name="group_date" domain="[]" context="{'group_by':'date_payment'}" />
						<filter string="Start Date" name="group_start_date" domain="[]" context="{'group_by':'date_start'}" />
						<filter string="Status" name="groupby_status" domain="[]" context="{'group_by':'state'}"/>
						<separator/>
						<filter string="City" name="group_by_city" domain="[]" context="{'group_by':'city_id'}"/>
						<filter string="Branch" name="group_by_branch" domain="[]" context="{'group_by':'branch_id'}"/>
					</group>

					 <searchpanel>
                        <field name="city_id"/>
                        <field name="branch_id" select="multi" domain="[('city_id','=',city_id)]"/>
						<field name="state"/>
						<field name="payment_channel"/>
                    </searchpanel>
				</search>
			</field>
		</record>

		<record id="hr_loan_pivot_view" model="ir.ui.view">
            <field name="name">hr.loan.pivot</field>
            <field name="model">hr.loan</field>
            <field name="arch" type="xml">
                <pivot string="Employee Loans" display_quantity="true">
                    <field name="branch_id" type="row"/>
					<field name="date_payment" interval="month" type="col"/>
					<field name="paid_amount" type="measure" widget="monetary"/>
                </pivot>
            </field>
        </record>

        <record id="hr_loan_graph_view" model="ir.ui.view">
            <field name="name">hr.loan.graph</field>
            <field name="model">hr.loan</field>
            <field name="arch" type="xml">
                <graph string="Employee Loans">
                    <field name="branch_id" type="row"/>
					<field name="date_payment" interval="month" type="col"/>
					<field name="paid_amount" type="measure" widget="monetary"/>
                </graph>
            </field>
        </record>
		
		<!-- hr_loan action -->
		<record id="hr_loan_action_view" model="ir.actions.act_window">
			<field name="name">Employee Loans</field>
			<field name="res_model">hr.loan</field>
			<field name="view_mode">tree,form,pivot,graph</field>
			<field name="search_view_id" ref="hr_loan_filter_view" />
		</record>

    </data>
</odoo>

